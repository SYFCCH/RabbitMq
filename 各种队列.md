# 1.死信队列   
###### 概念  
死信就是没有被消费的消息，要处理这样的死信要用到死信队列   
###### 应用场景
为了保证订单业务的消息数据不丢失，需要使用到RabbitMQ的死信队列机制，当消息消费发生异常时，将消息投入死信队列中   
下单后支付超时，订单自动失效   

###### 死信的来源
* 消息TTL（存活时间）过期   
* 队列达到最大长度(队列满了，无法再添加数据到mq中)
* 消息被拒绝(basic,reject/basic.nack)并且requeue=false

##### 死信队列代码：

###### 消费者代码
![img_65.png](img_65.png)   

###### 生产者代码




设置TTL存活时间以及其他参数的原理   
在生产者发消息的时候设置，首先是basicPublish方法的第三个参数是BasicProperties，点进去BasicProperties类{父类是AMQP接口(高级消息队列协议Advanced Message Queuing Protocol)}我们可以看到一些参数      
![img_71.png](img_71.png)    
![img_67.png](img_67.png)     

BasicProperties类的源码使用了建造者模式来链式构建参数   
![img_68.png](img_68.png)     
![img_69.png](img_69.png)     
![img_73.png](img_73.png)    
builder()的build()方法可以返回这些参数     
![img_74.png](img_74.png)    



