
##### RabbitMQ幂等性问题    
幂等性:多次操作的结果是一致的，不会因为多次点击产生副作用      
问到幂等性问题，就是问你如何防止重复消费

解决方案可以用唯一ID     
最佳解决方案是利用Redis的setnx，天生具有幂等性     
 

### 一些场景题  
##### 1. 订单催付，大客户小客户使用优先级队列    
![img_117.png](img_117.png)   

这种情况使用RabbitMQ的优先级队列，队列等级为0-255，数字越大越优先   

把优先队列的使用和面试官说就行   

##### 2. 什么消费者下线宕机啊，维护啊，大量消息积累的时候，就可以使用惰性队列将消息写入到磁盘中      

![img_118.png](img_118.png)    
把惰性队列吧啦吧啦全部将给面试官听   

#### 3. 如何实现高可用，负载均衡  
nginx加Keepalive实现负载均衡  

# ip漂移，面试重点！，不过不是rabbitmq考察的范围，看到这里一定要去熟悉ip漂移的细节   

#### 4. 不同地区之间机房的消息同步问题   

用到联邦交换机或者Shovel   

###### Federation Exchange
![img_124.png](img_124.png)    
**原理**   
先运行consumer在node2创建fed_exchange  
![img_125.png](img_125.png)   
1号交换机在同步数据给2号节点的时候，2号得提前拥有交换机    

###### Shovel   
![img_123.png](img_123.png)   

说实话这些是运维干的吧。。。。。。    